<template>
  <div class={computedRootClass}>
    <div class="dashboard-header">
      <div class="header-content">
        <div class="header-left">
          <lightning-icon icon-name="utility:dashboard" size="medium" class="dashboard-header-icon"></lightning-icon>
          <h1 class="dashboard-title">Dashboards</h1>
        </div>
      </div>
    </div>

    <div class="dashboard-content">
      <div class="filters-bar">
        <div class="filters-left">
          <lightning-input type="toggle" label="Mine only" checked={filterMine}
            onchange={handleToggleMine}></lightning-input>
        </div>
        <div class="filters-right">
          <lightning-combobox label="Project" value={projectId} options={projectOptions} placeholder="All projects"
            onchange={handleProjectChange}></lightning-combobox>

          <lightning-combobox label="Status" value={statusScope} options={statusScopeOptions}
            onchange={handleStatusScopeChange}></lightning-combobox>

          <lightning-combobox label="Date range" value={dateRange} options={dateRangeOptions}
            onchange={handleDateRangeChange}></lightning-combobox>
          <template if:true={isCustomDateRange}>
            <lightning-input type="date" label="Start" value={customStart}
              onchange={handleCustomStart}></lightning-input>
            <lightning-input type="date" label="End" value={customEnd} onchange={handleCustomEnd}></lightning-input>
          </template>
        </div>
      </div>

      <div class="metrics-grid">
        <div class="metric-card">
          <div class="metric-label">Total Tasks</div>
          <div class="metric-value">{dashboardStats.total}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">My Tasks</div>
          <div class="metric-value">{dashboardStats.mine}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">In Progress</div>
          <div class="metric-value">{dashboardStats.inProgress}</div>
        </div>
        <div class="metric-card">
          <div class="metric-label">Completed</div>
          <div class="metric-value">{dashboardStats.completed}</div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">Status Distribution</div>
        <div class="status-bar">
          <template for:each={statusDistribution} for:item="seg">
            <div key={seg.label} class="status-segment" data-pct={seg.pct} data-color={seg.color} title={seg.title}>
            </div>
          </template>
        </div>
        <div class="legend">
          <template for:each={statusDistribution} for:item="seg">
            <div key={seg.label} class="legend-item">
              <span class="legend-swatch" data-color={seg.color}></span>
              <span class="legend-label">{seg.label} ({seg.count})</span>
            </div>
          </template>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">Tasks by Priority</div>
        <div class="priority-bar">
          <template for:each={priorityDistribution} for:item="p">
            <div key={p.label} class="priority-segment" data-pct={p.pct} data-color={p.color} title={p.title}></div>
          </template>
        </div>
        <div class="legend">
          <template for:each={priorityDistribution} for:item="p">
            <div key={p.label} class="legend-item">
              <span class="legend-swatch" data-color={p.color}></span>
              <span class="legend-label">{p.label} ({p.count})</span>
            </div>
          </template>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">Throughput <span class="chart-subtitle">(fixed 7/30 day windows)</span></div>
        <div class="throughput-grid">
          <div class="throughput-card">
            <div class="t-label">Last 7 days</div>
            <div class="t-value">{throughput7}</div>
          </div>
          <div class="throughput-card">
            <div class="t-label">Last 30 days</div>
            <div class="t-value">{throughput30}</div>
          </div>
        </div>
      </div>

      <div class="chart-card">
        <div class="chart-title">Aging by Status (Avg Days)</div>
        <div class="aging-list">
          <template for:each={agingByStatus} for:item="row">
            <div key={row.label} class="aging-row">
              <div class="aging-status">{row.label}</div>
              <div class="aging-metrics">
                <span class="aging-avg">{row.avgDays}</span>
                <span class="aging-count">({row.count})</span>
              </div>
            </div>
          </template>
        </div>
      </div>
    </div>
  </div>
</template>